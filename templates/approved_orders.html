<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Approved Orders</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Logo & Icons -->
  <link rel="icon" href="https://res.cloudinary.com/dl2ipzxyk/image/upload/v1751107241/logo_ijmteg.avif" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Bootstrap & DataTables -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">

  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
    }

    .navbar-brand img {
      height: 40px;
    }

    .container-fluid {
      padding: 30px;
    }

    h2 {
      font-weight: 600;
      margin-bottom: 20px;
    }

    .table-responsive {
      margin-top: 20px;
    }

    th, td {
      vertical-align: middle;
      text-align: center;
    }

    .dt-buttons .btn {
      margin-right: 8px;
    }

    #filtersRow .form-select {
      font-size: 0.875rem;
    }

    .header-bar {
      background: #0d6efd;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<!-- âœ… Top Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm px-4">
  <a class="navbar-brand d-flex align-items-center" href="#">
    <img src="https://res.cloudinary.com/dl2ipzxyk/image/upload/v1751107241/logo_ijmteg.avif" alt="Logo" class="me-2">
    <span class="fw-bold text-primary">True Type</span>
  </a>
</nav>

<div class="container-fluid">
  <div class="header-bar d-flex align-items-center justify-content-between flex-wrap">
    <h2 class="mb-0"><i class="bi bi-check2-circle me-2"></i>Approved Orders</h2>
  </div>

  <!-- ðŸ”Ž Filters Row -->
  <div class="row mt-3 g-2" id="filtersRow"></div>

  <!-- ðŸ“Š Orders Table -->
  <div class="table-responsive">
    <table id="approvedOrdersTable" class="table table-striped table-bordered w-100">
      <thead class="table-dark">
        <tr>
          <th><i class="bi bi-calendar3"></i><br>Date</th>
          <th><i class="bi bi-person-circle"></i><br>Client</th>
          <th><i class="bi bi-truck"></i><br>Vehicle #</th>
          <th><i class="bi bi-geo-alt"></i><br>Region</th>
          <th><i class="bi bi-fuel-pump"></i><br>Product</th>
          <th>OMC</th>
          <th>BDC</th>
          <th>DEPOT</th>
          <th>Qty</th>
          <th>P-BDC-OMC</th>
          <th>S-BDC-OMC</th>
          <th><i class="bi bi-cash-coin"></i><br>Margins</th>
          <th>Returns</th>
          <th>Tax</th>
          <th>Total Debt</th>
          <th>Paid</th>
          <th>Left</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ order.date.strftime('%d-%b-%Y') if order.date else '-' }}</td>
          <td>
            <a href="/admin/client/{{ order.client_mongo_id }}" class="text-decoration-none fw-semibold text-primary">
              {{ order.client_name }}
            </a>
          </td>
          <td>{{ order.vehicle_number }}</td>
          <td>{{ order.region }}</td>
          <td>{{ order.product }}</td>
          <td>{{ order.omc }}</td>
          <td>{{ order.bdc }}</td>
          <td>{{ order.depot }}</td>
          <td>{{ "{:,}".format(order.quantity|int) }}</td>
          <td>{{ order.p_bdc_omc }}</td>
          <td>{{ order.s_bdc_omc }}</td>
          <td>{{ "%.2f" % order.margin }}</td>
          <td>{{ "%.2f" % order.returns }}</td>
          <td>{{ "%.2f" % order.tax if order.tax else "0.00" }}</td>
          <td>{{ "%.2f" % order.total_debt if order.total_debt else "0.00" }}</td>
          <td>{{ "%.2f" % order.amount_paid if order.amount_paid else "0.00" }}</td>
          <td>
            {% set left = (order.total_debt or 0) - (order.amount_paid or 0) %}
            {{ "%.2f" % left }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- âœ… JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>

<script>
  $(document).ready(function () {
    const table = $('#approvedOrdersTable').DataTable({
      responsive: true,
      ordering: true,
      pageLength: 50,
      order: [[0, 'desc']],
      dom: 'Bfrtip',
      buttons: [
        {
          extend: 'excelHtml5',
          className: 'btn btn-success btn-sm',
          title: 'Approved Orders',
          exportOptions: { columns: ':visible' }
        },
        {
          extend: 'pdfHtml5',
          className: 'btn btn-danger btn-sm',
          title: 'Approved Orders',
          orientation: 'landscape',
          pageSize: 'A4',
          exportOptions: { columns: ':visible' }
        },
        {
          extend: 'csvHtml5',
          className: 'btn btn-info btn-sm',
          title: 'Approved Orders',
          exportOptions: { columns: ':visible' }
        }
      ]
    });

    $('#filtersRow').empty();
    table.columns().every(function () {
      const column = this;
      const header = $(column.header()).text().trim();
      const select = $(`<div class="col-md-2">
                          <select class="form-select form-select-sm" title="${header}">
                            <option value="">All ${header}</option>
                          </select>
                        </div>`).appendTo('#filtersRow').find('select')
        .on('change', function () {
          const val = $.fn.dataTable.util.escapeRegex($(this).val());
          column.search(val ? '^' + val + '$' : '', true, false).draw();
        });

      column.data().unique().sort().each(function (d) {
        if (d && d.toString().trim() !== '') {
          select.append(`<option value="${d}">${d}</option>`);
        }
      });
    });
  });
</script>

</body>
</html>
